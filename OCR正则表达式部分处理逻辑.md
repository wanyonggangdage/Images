# <center> OCR 正则表达式部分处理逻辑
## 自动生成正则表达式部分匹配方案

1. 用于测试的数据如下：  
原始字符串：
```
S/HE150309CT30Z4 M7SVIMap 18 1938
```

配置的识别规则及生成的正则表达式：
![image](https://wanyonggangdage.github.io/Images/22.PNG)  

2. 得到配置表达式：
```
~~ME~~5-6~~CT~~3-6~~~~
```   
3. 去除掉原始字符内的空格字符，结果如下：
```
S/HE150309CT30Z4M7SVIMap181938
```  
4. 接下来程序分两种情况进行处理，首先第一种正则表达式可以完成匹配：
我们把初始字符串改为：
```
S/HE150309CT3024 M7SVIMap 18 1938
```  
也就是将'Z' 换成 ‘2’ ，经过正则表达式匹配后的字符串：  
```
HE150309CT3024
```  
下一步纠正前缀中缀后缀中的错误字符，我们自动生成的正则表达式如下：
```
([MHNm]\s*[EFGZS]\s*)(\d{5,6})\s*([C0OQGc]\s*[T7F1IlYt]\s*)(\d{3,7})\s*
```  

我们可以看到，生成的正则表达式相当规整，一共有4个分组（每个分组的内容写在一个小括号内，\s 匹配任何空白字符，包括空格，制表符，换行符等），分别代表 前缀，数字段，中缀，数字段。程序处理逻辑也很简单，保留数字段内容，将前缀，中缀，后缀 替换成配置的内容。我们可以得到如下结果：
```
ME150309CT3024
``` 
5. 数字中包含字母，如 2 被识别成了 Z：
原始字符串：
```
S/HE150309CT30Z4 M7SVIMap 18 1938
```

一旦经过自动生成的正则表达式匹配不成功，先拆分出前缀的正则表达式：
```
([MHNm]\\s*[EFGZS]\\s*)
```  
利用该正则先去匹配出前缀，再去匹配数字段，可以匹配成功，再去匹配中缀，匹配成功，匹配中缀后的数字段，匹配不成功，进入如下处理过程：

- 利用下表进行替换操作，将字母替换为数字，发现第一个无法替换的字母时停止，当数字超过数字段最大字符数时也要停止替换。另外如果包含后缀，匹配到后缀所在位置也要停止替换。得到的数字个数符合数字长度要求，匹配成功，不符合匹配不成功。
- 用前缀，中缀，后缀字符替换掉匹配出的前缀，中缀，后缀字符。

```
                                                    {"A", "4"},
                                                    {"B", "8"},
                                                    {"C", "0"},
                                                    {"D", "0"},
                                                    {"E", ""},
                                                    {"F", "7"},
                                                    {"G", "6"},
                                                    {"H", ""},
                                                    {"I", "1"},
                                                    {"J", "3"},
                                                    {"K", ""},
                                                    {"L", ""},
                                                    {"M", ""},
                                                    {"N", ""},
                                                    {"O", "0"},
                                                    {"P", "9"},
                                                    {"Q", "0"},
                                                    {"R", "8"},
                                                    {"S", "5"},
                                                    {"T", "7"},
                                                    {"U", "0"},
                                                    {"V", ""},
                                                    {"W", "4"},
                                                    {"X", "4"},
                                                    {"Y", ""},
                                                    {"Z", "2"},
                                                    {"a", ""},
                                                    {"b", "6"},
                                                    {"c", ""},
                                                    {"d", "6"},
                                                    {"e", ""},
                                                    {"f", ""},
                                                    {"g", ""},
                                                    {"h", ""},
                                                    {"i", "1"},
                                                    {"j", ""},
                                                    {"k", ""},
                                                    {"l", "1"},
                                                    {"m", ""},
                                                    {"n", ""},
                                                    {"o", "0"},
                                                    {"p", "9"},
                                                    {"q", "9"},
                                                    {"r", ""},
                                                    {"s", "5"},
                                                    {"t", "1"},
                                                    {"u", ""},
                                                    {"v", ""},
                                                    {"w", ""},
                                                    {"x", ""},
                                                    {"y", ""},
                                                    {"z", "2"}
```  


## 手动输入正则表达式的匹配方案
1. 用于测试的数据如下：  
原始字符串：
```
S/HE150309CT30Z4 M7SVIMap 18 1938
```
用于匹配的正则表达式：
```
([MHNm]\s*[EFGZS]\s*)(\d{5,6})\s*([C0OQGc]\s*[T7F1IlYt]\s*)(\d{3,7})\s*
``` 